---
title: "Comparing-CRSP-and-CRFS-data"
author: "Rachel Brooks"
format: pdf
editor: visual
---

## Comparing CRFS & CRSP Data

### California Recreational Fisheries Survey (CRFS) Data:

CRFS data was retrieved from the Recreational Fisheries Information Network (<https://www.recfin.org/>).

**Date Accessed:** August 29th, 2023 (*needs to be updated every time data is downloaded*)

**Date Range of CFRFS Data:** 01/2023-07/2023 (*needs to be updated every time data is downloaded*)

**Notes about CRFS Data:** Data filtered to include only fish sampled in CA within 2023 from party/charter boats. Data filtered to include all all ports, all water areas, all fish areas, all trip types, all sources, both released and retained, groundfish, all complexes, rockfish, all species.

### Cooperative Recreational Sampling Program (CRSP) Data:

CRSP data is currently being stored on Google Drive in Google Sheets: [https://docs.google.com/spreadsheets/d/1gfTqfUz6_yY_UaC8doQJY6xqRCaN7I-5W0e9DHwJnmU/edit#gid=0](https://docs.google.com/spreadsheets/d/1gfTqfUz6_yY_UaC8doQJY6xqRCaN7I-5W0e9DHwJnmU/edit#gid=0https://docs.google.com/spreadsheets/d/1gfTqfUz6_yY_UaC8doQJY6xqRCaN7I-5W0e9DHwJnmU/edit#gid=0)

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--

Import, rename, and merge the CRFS and CRSP data tables into one single data frame ('Full_Data') for species-specific comparison within management districts.

```{r, warning = FALSE, message = FALSE, echo = TRUE}

knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = TRUE)
library(tidyverse)
library(data.table)
library(ggplot2)
library(googlesheets4)

#gs4_deauth()
#gs4_auth()

#Pull Data from Google Sheets; Selection: 1 for authentication
CRSP_Data <- read_sheet("https://docs.google.com/spreadsheets/d/1gfTqfUz6_yY_UaC8doQJY6xqRCaN7I-5W0e9DHwJnmU/edit#gid=0")

PacFIN_Codes <- read.csv("PAcFIN_Codes.csv")
PacFIN_Codes <- PacFIN_Codes %>% 
  rename(PacFIN_Species_Code = PACFIN_SPECIES_CODE)

CRSP_RecFIN_port_renaming <- c("Eureka" = "6 - Northern", "Shelter Cove" = "5 - Mendocino", "Fort Bragg" = "5 - Mendocino", "Bodega Bay" = "4 - San Francisco", "Emeryville" = "4 - San Francisco", "Sausalito" = "4 - San Francisco", "Half Moon Bay" = "4 - San Francisco", "Santa Cruz" = "3 - Central", "Moss Landing" = "3 - Central", "Morro Bay" = "3 - Central", "Avila Beach" = "3 - Central", "Santa Barbara" = "1 & 2 - Southern", "Channel Islands" = "1 & 2 - Southern","Marina Del Rey" = "1 & 2 - Southern", "san Pedro" = "1 & 2 - Southern", "Dana Point" = "1 & 2 - Southern", "San Diego" = "1 & 2 - Southern")

CRSP_Data <- CRSP_Data %>% 
  mutate(RecFIN_Port_Name = CRSP_RecFIN_port_renaming[Port])

CRSP_Data_2 <- CRSP_Data %>% 
merge(.,PacFIN_Codes,by = intersect('PacFIN_Species_Code','PacFIN_Species_Code'), all = F) %>%
select(c(Project_ID,Year,Sample_ID,RecFIN_Port_Name,Port,Vessel,CDFW_Vessel_Number,Capture_Date,SPECIES_NAME,PacFIN_Species_Code,Fork_Length_mm,Sex,Maturity,Otoliths_Retained,Fin_Clip_Retained))


CRSP_Data <- CRSP_Data %>% 
  merge(.,PacFIN_Codes,by = intersect('PacFIN_Species_Code','PacFIN_Species_Code'), all = F) %>%
  select(c(PacFIN_Species_Code,RecFIN_Port_Name,Fork_Length_mm,SPECIES_NAME))

CRSP_Data <- CRSP_Data %>%
  rename(RECFIN_PORT_NAME = RecFIN_Port_Name, LENGTH_MM = Fork_Length_mm)

CRSP_Data <- select(CRSP_Data,'RECFIN_PORT_NAME','SPECIES_NAME','LENGTH_MM')

CRSP_Data <- CRSP_Data %>%
  mutate(DATA_SOURCE = rep("CRSP", n()))


#Import CRFS data and filter by CDFW management region
CRFS_Data <- read.csv("CRFS-Data-Accessed-20231016.csv")

CRFS_RecFIN_port_renaming <- c("REDWOOD (HUMBOLDT COUNTY, EXCEPT SHELTER COVER AREA, AND DEL NORTE COUNTY)" = "6 - Northern", "WINE (MENDOCINO COUNTY AND SHELTER COVE AREA IN HUMBOLDT COUNTY)" = "5 - Mendocino", "BAY AREA (SONOMA, MARIN, SOLANO, NAPA, CONTRA COSTA, ALAMEDA, SANTA CLARA, SAN MATEO, SAN FRANCISCO COUNTIES)" = "4 - San Francisco", "CENTRAL (SAN LUIS OBISPO, MONTEREY AND SANTA CRUZ COUNTIES)" = "3 - Central", "CHANNEL (VENTURA AND SANTA BARBARA COUNTIES)" = "1 & 2 - Southern", "SOUTH (SAN DIEGO, ORANGE AND LOS ANGELES COUNTIES)" = "1 & 2 - Southern")

CRFS_Data <- CRFS_Data %>% 
  rename(SPECIES_NAME = Species.Name, RECFIN_PORT_NAME = RecFIN.Port.Name, LENGTH_MM = RecFIN.Length.MM)

CRFS_Data <- CRFS_Data %>% 
  mutate(RECFIN_PORT_NAME = CRFS_RecFIN_port_renaming[RECFIN_PORT_NAME])

CRFS_Data <- select(CRFS_Data,'RECFIN_PORT_NAME','SPECIES_NAME','LENGTH_MM')

CRFS_Data <- CRFS_Data %>%
  mutate(DATA_SOURCE = rep("CRFS", n()))

#Merge the two data types into one master dataset
Full_Data <- rbind(CRFS_Data, CRSP_Data)
Full_Data <- Full_Data[,c(4,1,2,3)]
Full_Data$LENGTH_MM <- as.numeric(Full_Data$LENGTH_MM)
```

### Filter CRFS & CRSP length data by CDFW Management Area

CDFW Management Area Include:

1.  **Northern** - Ports between the OR/CA Border to Cape Mendocino Area
2.  **Mendocino** - Ports between the Cape Mendocino Area to Point Arena
3.  **San Francisco** - Ports between the Point Arena to Pigeon Point
4.  **Central** - Ports between the Pigeon Point to Point Conception
5.  **Southern** - Ports between the Point Conception to US/MX Border

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--

Filter 'Full_Data' into separate dataframes for each CDFW management region. Create tables to view number of lengths from each data set (CRFS & CRSP) by species.

```{r, warning = FALSE, message = FALSE, echo = TRUE}

library(modelsummary)
library(tidyverse)

#NORTHERN
Northern <- Full_Data %>%
  group_by(RECFIN_PORT_NAME) %>%
  filter(RECFIN_PORT_NAME == "6 - Northern")

#MENDOCINO
Mendocino <- Full_Data %>%
  group_by(RECFIN_PORT_NAME) %>%
  filter(RECFIN_PORT_NAME == "5 - Mendocino")

#SAN FRANCISCO
San_Francisco <- Full_Data %>%
  group_by(RECFIN_PORT_NAME) %>%
  filter(RECFIN_PORT_NAME == "4 - San Francisco")

#CENTRAL
Central <- Full_Data %>%
  group_by(RECFIN_PORT_NAME) %>%
  filter(RECFIN_PORT_NAME == "3 - Central")

#SOUTHERN
Southern <- Full_Data %>%
  group_by(RECFIN_PORT_NAME) %>%
  filter(RECFIN_PORT_NAME == "1 & 2 - Southern")
```

### Length Distribution Plots Comparing CRFS & CRSP Data

Species-specific density distribution plots comparing species-specific CRFS & CRPS surveyed lengths. Species plots where no distribution occurs only had one specimen sampled from either CRFS or CRSP.

```{r, warning = FALSE, message = FALSE, echo = TRUE, fig.height=30, fig.width=20}

alpha = 0.5
theme_set(theme_classic(base_size = 20))

#NORTHERN
Northern_length_plot <- ggplot(Northern, aes(x = LENGTH_MM, fill = DATA_SOURCE))+
  geom_density(lwd = 1.2, linetype = 1, alpha = 0.7)+
  scale_fill_manual(values = c("tomato","steelblue3"))+
  facet_wrap(~SPECIES_NAME , ncol = 2, scales = "free")+
  labs(x = "Fork Length (cm)", y = "Frequency", title = "Northern CA Management")
print(Northern_length_plot)


#MENDOCINO
Mendocino_length_plot <- ggplot(Mendocino, aes(x = LENGTH_MM, fill = DATA_SOURCE))+
  geom_density(lwd = 1.2, linetype = 1, alpha = 0.7) + 
  scale_fill_manual(values = c("tomato","steelblue3"))+  
  facet_wrap(~ SPECIES_NAME , ncol = 2, scales = "free_y") +
  labs(x = "Fork Length (cm)", y = "Frequency", title = "Mendocino CA Management")
print(Mendocino_length_plot)


#SAN FRANCISCO
San_Francisco_length_plot <- ggplot(San_Francisco, aes(x = LENGTH_MM, fill = DATA_SOURCE))+
  geom_density(lwd = 1.2, linetype = 1, alpha = 0.7) + 
  scale_fill_manual(values = c("tomato","steelblue3"))+
  facet_wrap(~ SPECIES_NAME , ncol = 2, scales = "free_y") +
  labs(x = "Fork Length (cm)", y = "Frequency", title = "San Francisco CA Management")
print(San_Francisco_length_plot)


#CENTRAL
Central_length_plot <- ggplot(Central, aes(x = LENGTH_MM, fill = DATA_SOURCE))+
  geom_density(lwd = 1.2, linetype = 1, alpha = 0.7) +
  scale_fill_manual(values = c("tomato","steelblue3"))+
  facet_wrap(~ SPECIES_NAME , ncol = 2, scales = "free_y") +
  labs(x = "Fork Length (cm)", y = "Frequency", title = "Central CA Management")
print(Central_length_plot)


#SOUTHERN
Southern_length_plot <- ggplot(Southern, aes(x = LENGTH_MM, fill = DATA_SOURCE))+
  geom_density(lwd = 1.2, linetype = 1, alpha = 0.7) + 
  scale_fill_manual(values = c("tomato","steelblue3"))+
  facet_wrap(~ SPECIES_NAME , ncol = 2, scales = "free_y") +
  labs(x = "Fork Length (cm)", y = "Frequency", title = "Southern CA Management")
print(Southern_length_plot)
```

## 
